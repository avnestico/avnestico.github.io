<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Choose-Your-Own CFB Playoff 2025</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  h1 { color: #2c3e50; }

  .game { margin-bottom: 15px; }
  .buttons { margin-top: 5px; }
  button.choice { margin-right: 10px; padding: 6px 12px; }
  .selected { background-color: #2c3e50; color: #fff; }

  .champion { font-weight: bold; }
  .firstOut { color: #a00; }

  .adjust-row { margin-bottom: 10px; }
  .adjust-row button { margin: 0 5px; padding: 4px 10px; }
  .active-adjust { background-color: #2c3e50; color: #fff; font-weight: bold; }

  /* Layout wrapper for desktop */
  .container {
    display: flex;
    gap: 100px;
    align-items: flex-start;
  }
  .column {
    flex: initial;
  }
  #results, #adjustments {
    padding: 15px;
    border: 1px solid #ccc;
    background: #f9f9f9;
  }
  #adjustments { background: #eef; }

  /* Mobile-friendly adjustments (stacked, 2x size) */
  @media (max-width: 950px) {
    body { font-size: 18px; }
    h1 { font-size: 26px; }
    .game { font-size: 18px; }
    button.choice {
      font-size: 18px;
      padding: 12px 20px;
      margin-bottom: 10px;
    }
    .buttons { margin-top: 10px; }
    #results { font-size: 18px; }
    #adjustments { font-size: 18px; }
    .adjust-row button { font-size: 18px; padding: 8px 16px; }

    /* Stack columns on mobile */
    .container {
      flex-direction: column;
      gap: 20px;
    }
  }
</style>
</head>
<body>
  <h1>Choose-Your-Own CFB Playoff 2025</h1>
  <h3>Loosely based on the latest coaches' poll. Adjustments will only move "close" teams up or down.</h3>

  <div class="container">
    <!-- Column 1: Games -->
    <div class="column">
      <div class="game">Big Ten Champion:
        <div class="buttons">
          <button id="btn-indiana" class="choice" onclick="setChoice('bigTen','Indiana')">Indiana</button>
          <button id="btn-ohio" class="choice" onclick="setChoice('bigTen','Ohio State')">Ohio State</button>
        </div>
      </div>
      <div class="game">Big 12 Champion:
        <div class="buttons">
          <button id="btn-tt" class="choice" onclick="setChoice('big12','Texas Tech')">Texas Tech</button>
          <button id="btn-byu" class="choice" onclick="setChoice('big12','BYU')">BYU</button>
        </div>
      </div>
      <div class="game">SEC Champion:
        <div class="buttons">
          <button id="btn-bama" class="choice" onclick="setChoice('sec','Alabama')">Alabama</button>
          <button id="btn-uga" class="choice" onclick="setChoice('sec','Georgia')">Georgia</button>
        </div>
      </div>
      <div class="game">ACC Champion:
        <div class="buttons">
          <button id="btn-virginia" class="choice" onclick="setChoice('acc','Virginia')">Virginia</button>
          <button id="btn-duke" class="choice" onclick="setChoice('acc','Duke')">Duke</button>
        </div>
      </div>
      <div class="game">American Champion:
        <div class="buttons">
          <button id="btn-nt" class="choice" onclick="setChoice('american','North Texas')">North Texas</button>
          <button id="btn-tulane" class="choice" onclick="setChoice('american','Tulane')">Tulane</button>
        </div>
      </div>
      <div class="game">Sun Belt Champion:
        <div class="buttons">
          <button id="btn-jmu" class="choice" onclick="setChoice('sunBelt','JMU')">JMU</button>
          <button id="btn-troy" class="choice" onclick="setChoice('sunBelt','Troy')">Troy</button>
        </div>
      </div>
      <div class="game">Mountain West Champion:
        <div class="buttons">
          <button id="btn-unlv" class="choice" onclick="setChoice('mwc','UNLV')">UNLV</button>
          <button id="btn-boise" class="choice" onclick="setChoice('mwc','Boise State')">Boise State</button>
        </div>
      </div>
    </div>

    <!-- Column 2: Results -->
    <div class="column">
      <div id="results"></div>
    </div>

    <!-- Column 3: Adjustments -->
    <div class="column">
      <div id="adjustments"></div>
    </div>
  </div>

<script>
let selections = {};
let adjustments = {}; 
let lastOrderedTeams = []; // cache last rendered order for adjustments

// Score chart values with conference info
const scoreChart = {
  "Ohio State": { win:1980, loss:1620, conference:"Big Ten", record:{wins:12, losses:0, winsBase:12, lossesBase:0} },
  "Indiana": { win:1925, loss:1575, conference:"Big Ten", record:{wins:12, losses:0, winsBase:12, lossesBase:0} },
  "Oregon": { fixed:1353, conference:"Big Ten", record:{wins:11, losses:1, winsBase:11, lossesBase:1} },
  "Georgia": { win:1582, loss:1240, conference:"SEC", record:{wins:11, losses:1, winsBase:11, lossesBase:1} },
  "Ole Miss": { fixed:1190, conference:"SEC", record:{wins:11, losses:1, winsBase:11, lossesBase:1} },
  "Texas A&M": { fixed:1178, conference:"SEC", record:{wins:11, losses:1, winsBase:11, lossesBase:1} },
  "Texas Tech": { win:1430, loss:1139, conference:"Big 12", record:{wins:11, losses:1, winsBase:11, lossesBase:1} },
  "Oklahoma": { fixed:1106, conference:"SEC", record:{wins:10, losses:2, winsBase:10, lossesBase:2} },
  "Notre Dame": { fixed:1061, conference:"Independent", record:{wins:10, losses:2, winsBase:10, lossesBase:2} },
  "Alabama": { win:1150, loss:1020, conference:"SEC", record:{wins:10, losses:2, winsBase:10, lossesBase:2} },
  "BYU": { win:1036, loss:990, conference:"Big 12", record:{wins:11, losses:1, winsBase:11, lossesBase:1} },
  "Miami": { fixed:960, conference:"ACC", record:{wins:10, losses:2, winsBase:10, lossesBase:2} },
  "Virginia": { win:674, loss:552, conference:"ACC", record:{wins:10, losses:2, winsBase:10, lossesBase:2} },
  "North Texas": { win:407, loss:333, conference:"American", record:{wins:11, losses:1, winsBase:11, lossesBase:1} },
  "Tulane": { win:396, loss:324, conference:"American", record:{wins:10, losses:2, winsBase:10, lossesBase:2} },
  "JMU": { win:392, loss:320, conference:"Sun Belt", record:{wins:11, losses:1, winsBase:11, lossesBase:1} },
  "UNLV": { win:275, loss:225, conference:"Mountain West", record:{wins:10, losses:2, winsBase:10, lossesBase:2} },
  "Duke": { win:264, loss:216, conference:"ACC", record:{wins:7, losses:5, winsBase:7, lossesBase:5} }
};

function setChoice(game, team) {
  selections[game] = team;
  const buttons = document.querySelectorAll(`.game .buttons button`);
  buttons.forEach(btn => {
    if (btn.getAttribute("onclick").includes(game) && btn.textContent === team) {
      btn.classList.add("selected");
    } else if (btn.getAttribute("onclick").includes(game)) {
      btn.classList.remove("selected");
    }
  });
  calculatePlayoff(true);
}

// Default favorites
const defaultFavorites = {
  bigTen: "Indiana",
  big12: "Texas Tech",
  sec: "Alabama",
  american: "North Texas",
  acc: "Virginia",
  sunBelt: "JMU",
  mwc: "UNLV"
};

window.onload = () => {
  for (let game in defaultFavorites) {
    setChoice(game, defaultFavorites[game]);
  }
  calculatePlayoff(true);
};

function getScore(team, outcome) {
  const entry = scoreChart[team];
  if (!entry) return 0;
  const baseScore = (entry.fixed !== undefined) ? entry.fixed : entry[outcome];
  const adj = adjustments[team] || 0;
  return baseScore * (1 + adj);
}

function getBaseScore(team, outcome) {
  const entry = scoreChart[team];
  if (!entry) return 0;
  return (entry.fixed !== undefined) ? entry.fixed : entry[outcome];
}

function setAdjustment(team, value) {
  if ((adjustments[team] || 0) === value) return;
  adjustments[team] = value;

  const row = document.getElementById("adjust-" + team.replace(/\s+/g, ""));
  if (row) {
    const buttons = row.querySelectorAll("button");
    buttons.forEach(btn => btn.classList.remove("active-adjust"));
    if (value === 0) {
      row.querySelector(".reset-btn").classList.add("active-adjust");
    } else if (value > 0) {
      row.querySelector(".plus-btn").classList.add("active-adjust");
    } else {
      row.querySelector(".minus-btn").classList.add("active-adjust");
    }
  }

  // Recompute results but do NOT rebuild adjustments order
  calculatePlayoff(false);
}

// Build adjustments UI for an ordered list of ALL teams; preserve adjustment states
function buildAdjustments(orderedTeams) {
  const container = document.getElementById("adjustments");
  container.innerHTML = "<h2>Personal Adjustments</h2>";

  orderedTeams.forEach(team => {
    if (!(team in adjustments)) adjustments[team] = 0;

    const row = document.createElement("div");
    row.className = "adjust-row";
    row.id = "adjust-" + team.replace(/\s+/g, "");
    row.innerHTML = `
      <button class="minus-btn" onclick="setAdjustment('${team}', -0.05)">-</button>
      <button class="reset-btn" onclick="setAdjustment('${team}', 0)">${team}</button>
      <button class="plus-btn" onclick="setAdjustment('${team}', 0.05)">+</button>
    `;
    container.appendChild(row);

    const value = adjustments[team] || 0;
    const minusBtn = row.querySelector(".minus-btn");
    const resetBtn = row.querySelector(".reset-btn");
    const plusBtn = row.querySelector(".plus-btn");
    minusBtn.classList.remove("active-adjust");
    resetBtn.classList.remove("active-adjust");
    plusBtn.classList.remove("active-adjust");
    if (value === 0) {
      resetBtn.classList.add("active-adjust");
    } else if (value > 0) {
      plusBtn.classList.add("active-adjust");
    } else {
      minusBtn.classList.add("active-adjust");
    }
  });

  lastOrderedTeams = orderedTeams.slice();
}

function updateConferenceRecords() {
  // Reset each team back to its baseline record
  for (let team in scoreChart) {
    const rec = scoreChart[team].record;
    if (rec) {
      rec.wins = rec.winsBase;
      rec.losses = rec.lossesBase;
    }
  }

  // Define the conference championship matchups
  const conferenceGames = {
    bigTen: ["Ohio State", "Indiana"],
    big12: ["Texas Tech", "BYU"],
    sec: ["Georgia", "Alabama"],
    american: ["North Texas", "Tulane"],
    acc: ["Virginia", "Duke"],
    sunBelt: ["JMU", "Troy"],       // add Troy if you want to track them
    mwc: ["UNLV", "Boise State"]    // add Boise State if you want to track them
  };

  // Apply win/loss increments based on selections
  for (let game in conferenceGames) {
    const matchup = conferenceGames[game];
    const selectedTeam = selections[game];
    if (!selectedTeam || !matchup.includes(selectedTeam)) continue;

    // Winner gets +1 win, the other team gets +1 loss
    if (scoreChart[selectedTeam] && scoreChart[selectedTeam].record) {
      scoreChart[selectedTeam].record.wins += 1;
    }
    matchup.forEach(team => {
      if (team !== selectedTeam && scoreChart[team] && scoreChart[team].record) {
        scoreChart[team].record.losses += 1;
      }
    });
  }
}

function calculatePlayoff(rebuildAdjustments = true) {
  updateConferenceRecords();

  const bigTen = selections.bigTen;
  const big12 = selections.big12;
  const sec = selections.sec;
  const american = selections.american;
  const acc = selections.acc;
  const sunBelt = selections.sunBelt;
  const mwc = selections.mwc;

  const conferenceTeams = [
    {conf:"bigTen", team:bigTen},
    {conf:"big12", team:big12},
    {conf:"sec", team:sec},
    {conf:"american", team:american},
    {conf:"acc", team:acc},
    {conf:"sunBelt", team:sunBelt},
    {conf:"mwc", team:mwc}
  ].filter(c => !!c.team);

  // Champion scores (win outcome with adjustments for ranking field)
  const championWins = conferenceTeams.map(c => ({
    team: c.team,
    score: getScore(c.team, "win"),
    champ: true
  })).sort((a,b)=>b.score-a.score);

  // Top 5 champions qualify
  const qualified = championWins.slice(0,5);
  const qualifiedTeamsSet = new Set(qualified.map(q => q.team));

  // Best remaining pool (loss/fixed) for non-qualified and others
  const bestRemainingByTeam = new Map();
  conferenceTeams.forEach(c => {
    const team = c.team;
    const lossScore = getScore(team, "loss");
    if (!qualifiedTeamsSet.has(team)) {
      const existing = bestRemainingByTeam.get(team);
      if (!existing || lossScore > existing.score) {
        bestRemainingByTeam.set(team, { team, score: lossScore, champ: false });
      }
    }
  });

  for (let team in scoreChart) {
    if (qualifiedTeamsSet.has(team)) continue;
    const entry = scoreChart[team];
    const score = (entry.fixed !== undefined) ? getScore(team, "fixed") : getScore(team, "loss");
    const existing = bestRemainingByTeam.get(team);
    if (!existing || score > existing.score) {
      bestRemainingByTeam.set(team, { team, score, champ: false });
    }
  }

  const atLarge = Array.from(bestRemainingByTeam.values())
    .sort((a,b)=>b.score-a.score)
    .slice(0,9);

  const finalTeams = qualified.concat(atLarge.slice(0,7)).sort((a,b)=>b.score-a.score);
  const firstTwoOut = atLarge.slice(7,9);

  // Render results with record included
  document.getElementById("results").innerHTML =
    "<h2>Your Seeding</h2><ol>" +
    finalTeams.map(t => {
      const conf = scoreChart[t.team]?.conference || "Unknown";
      const rec = scoreChart[t.team]?.record;
      const recordText = rec ? ` [${rec.wins}-${rec.losses}]` : "";
      return "<li class='" + (t.champ ? "champion" : "") + "'>" +
        t.team + " (" + conf + ")" + recordText + "</li>";
    }).join("") +
    "</ol>" +
    "<h3>First Two Out</h3><ul>" +
    firstTwoOut.map(t => {
      const conf = scoreChart[t.team]?.conference || "Unknown";
      const rec = scoreChart[t.team]?.record;
      const recordText = rec ? ` [${rec.wins}-${rec.losses}]` : "";
      return "<li class='firstOut'>" + t.team + " (" + conf + ")" + recordText + "</li>";
    }).join("") +
    "</ul>";

  // Determine baseline for ALL teams based on current playoff composition:
  // - If a team is a champ in finalTeams: use baseline 'win'
  // - Else: use baseline 'fixed' if fixed exists, otherwise 'loss'
  const champSet = new Set(finalTeams.filter(t => t.champ).map(t => t.team));
  const orderedByBaselineNow = Object.keys(scoreChart)
    .map(team => {
      const entry = scoreChart[team];
      const outcome = champSet.has(team)
        ? "win"
        : (entry.fixed !== undefined ? "fixed" : "loss");
      return { team, baseScore: getBaseScore(team, outcome) };
    })
    .sort((a,b) => b.baseScore - a.baseScore)
    .map(x => x.team);

  const orderChanged =
    lastOrderedTeams.length !== orderedByBaselineNow.length ||
    orderedByBaselineNow.some((t, i) => lastOrderedTeams[i] !== t);

  if (rebuildAdjustments && orderChanged) {
    buildAdjustments(orderedByBaselineNow);
  }
}
</script>
</body>
</html>
